<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Formulario de Solicitudes - IPS Interconsultas</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f7fb;
      color: #1a1a1a;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      background: #fff;
      margin: 40px auto;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #0a3978;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 12px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
    }
    textarea { resize: vertical; }
    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      background-color: #0a3978;
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover { background-color: #0c4da2; }
    .hidden { display: none; }
    .success {
      text-align: center;
      background: #e8f8f0;
      color: #107a44;
      border: 1px solid #a7e1c1;
      border-radius: 6px;
      padding: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìã Solicitud a Mantenimiento</h2>
    <form id="reporteForm">
      <label>Fecha</label>
      <input type="text" id="fecha" readonly>

      <label>Hora</label>
      <input type="text" id="hora" readonly>

      <label>Nombre completo</label>
      <input type="text" id="nombre" required placeholder="Ej: Juan Manuel Correa">

      <label>Tipo de reporte</label>
      <select id="tipoReporte" required>
        <option value="">Seleccione...</option>
        <option value="Infraestructura">Infraestructura</option>
        <option value="Equipo M√©dico">Equipo M√©dico</option>
      </select>

      <!-- INFRAESTRUCTURA -->
      <div id="infraestructura" class="hidden">
        <label>√Årea espec√≠fica</label>
        <select id="areaInfra">
          <option value="">Seleccione...</option>
          <option>Consulta externa</option>
          <option>Urgencias</option>
          <option>Hospitalizaci√≥n</option>
          <option>Laboratorio</option>
          <option>Administraci√≥n</option>
          <option>Sala de procedimientos</option>
          <option>Sala de espera</option>
        </select>

        <label>Ubicaci√≥n espec√≠fica</label>
        <select id="ubicacionInfra">
          <option value="">Seleccione...</option>
          <option>Piso 1</option>
          <option>Piso 2</option>
          <option>Piso 3</option>
          <option>S√≥tano</option>
        </select>

        <label>Sede</label>
        <select id="sedeInfra">
          <option value="">Seleccione...</option>
          <option>Sede 1 - Principal</option>
          <option>Sede 2 - La 33</option>
          <option>Sede 3 - Palermo</option>
          <option>Sede 4 - Villamar√≠a</option>
        </select>

        <label>Clasificaci√≥n de prioridad</label>
        <select id="prioridadInfra">
          <option>Baja</option>
          <option>Media</option>
          <option>Alta</option>
          <option>Cr√≠tica</option>
        </select>

        <label>Categor√≠a del reporte</label>
        <select id="categoriaInfra">
          <option value="">Seleccione...</option>
          <option>El√©ctrico</option>
          <option>Plomer√≠a</option>
          <option>Carpinter√≠a</option>
          <option>Pintura</option>
          <option>Limpieza</option>
          <option>Otros</option>
        </select>

        <label>Descripci√≥n detallada del reporte</label>
        <textarea id="descripcionInfra" placeholder="Describa brevemente la novedad..."></textarea>
      </div>

      <!-- EQUIPO M√âDICO -->
      <div id="equipoMedico" class="hidden">
        <label>Equipo a reportar</label>
        <select id="equipoMed">
          <option value="">Seleccione...</option>
          <option>Monitor de signos vitales</option>
          <option>Electrocardi√≥grafo</option>
          <option>Balanza</option>
          <option>Ox√≠metro</option>
          <option>Desfibrilador</option>
          <option>Otro</option>
        </select>

        <label>Sede</label>
        <select id="sedeMed">
          <option value="">Seleccione...</option>
          <option>Sede 1 - Principal</option>
          <option>Sede 2 - La 33</option>
          <option>Sede 3 - Palermo</option>
          <option>Sede 4 - Villamar√≠a</option>
        </select>

        <label>√Årea</label>
        <select id="areaMed">
          <option value="">Seleccione...</option>
          <option>Consulta externa</option>
          <option>Urgencias</option>
          <option>Hospitalizaci√≥n</option>
          <option>Laboratorio</option>
        </select>

        <label>Ubicaci√≥n espec√≠fica</label>
        <input type="text" id="ubicacionMed" placeholder="Ej: Sala 2, consultorio 3...">

        <label>Da√±o a reportar</label>
        <textarea id="danioMed" placeholder="Describa el da√±o del equipo..."></textarea>

        <label>Prioridad del caso</label>
        <select id="prioridadMed">
          <option>Baja</option>
          <option>Media</option>
          <option>Alta</option>
          <option>Cr√≠tica</option>
        </select>
      </div>

      <button type="submit">Enviar solicitud</button>
      <div id="mensaje" class="success hidden">‚úÖ Solicitud enviada con √©xito</div>
    </form>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyIeRDE-CLdIqdoRMDwPpyqrhsgUnkBzQvwaG4hkTRWXeiDOQvmtYGi8s4ZD-fgBt8t/exec";
    const form = document.getElementById("reporteForm");
    const tipoReporte = document.getElementById("tipoReporte");
    const infra = document.getElementById("infraestructura");
    const med = document.getElementById("equipoMedico");
    const mensaje = document.getElementById("mensaje");

    function setFechaHora() {
      const now = new Date();
      document.getElementById("fecha").value = now.toLocaleDateString();
      document.getElementById("hora").value = now.toLocaleTimeString();
    }
    setFechaHora();

    tipoReporte.addEventListener("change", () => {
      infra.classList.toggle("hidden", tipoReporte.value !== "Infraestructura");
      med.classList.toggle("hidden", tipoReporte.value !== "Equipo M√©dico");
    });

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const data = {
        nombre: document.getElementById("nombre").value,
        tipoReporte: tipoReporte.value,
        sede: tipoReporte.value === "Infraestructura" ? document.getElementById("sedeInfra").value : document.getElementById("sedeMed").value,
        area: tipoReporte.value === "Infraestructura" ? document.getElementById("areaInfra").value : document.getElementById("areaMed").value,
        ubicacion: tipoReporte.value === "Infraestructura" ? document.getElementById("ubicacionInfra").value : document.getElementById("ubicacionMed").value,
        prioridad: tipoReporte.value === "Infraestructura" ? document.getElementById("prioridadInfra").value : document.getElementById("prioridadMed").value,
        categoria: document.getElementById("categoriaInfra") ? document.getElementById("categoriaInfra").value : "",
        descripcion: tipoReporte.value === "Infraestructura" ? document.getElementById("descripcionInfra").value : document.getElementById("danioMed").value,
        equipo: tipoReporte.value === "Equipo M√©dico" ? document.getElementById("equipoMed").value : ""
      };

      fetch(scriptURL, {
        method: "POST",
        mode: "cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (res.ok) {
          mensaje.classList.remove("hidden");
          form.reset();
          setFechaHora();
          infra.classList.add("hidden");
          med.classList.add("hidden");
          setTimeout(() => mensaje.classList.add("hidden"), 3000);
        } else {
          alert("Error al enviar la solicitud.");
        }
      })
      .catch(err => {
        console.error("Error:", err);
        alert("Error de conexi√≥n. Revise el enlace del Script o permisos.");
      });
    });
  </script>
</body>
</html>

